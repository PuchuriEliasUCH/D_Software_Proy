<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Dashboard Admin — DASSO by StoqING</title>

    <!-- Fuentes iguales que en landing -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
</head>
<body>
<!-- Header con el mismo estilo que el index -->
<header th:insert="~{/fragments/general/navbar :: navbar}"></header>

<main class="container-main">
    <div class="card">
        <h4>Panel Administrativo</h4>
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
            <label class="small-muted" for="adminDate" style="min-width:110px">Selecciona fecha:</label>
            <input id="adminDate" type="date" name="fecha" class="form-control" onchange="listarCards()" style="max-width:200px"/>


            <div style="margin-left:auto; display:flex; gap:8px;">
                <a th:href="@{/gestion_mesas}" id="mesasBtn" class="btn btn-primary" type="button">Ir a Mesas</a>
                <form th:action="@{/logout}" method="post">
                    <button id="logoutBtn" class="btn btn-outline-danger" type="submit">Cerrar sesión</button>
                </form>
            </div>
        </div>

        <!-- KPIs del documento -->
        <div style="margin-top:18px" class="kpis">
            <div class="kpi">
                <div class="small-muted">Reservas canceladas</div>
                <div class="value" id="kpiCanceladas">0</div>
            </div>
            <div class="kpi">
                <div class="small-muted">Reservas programadas</div>
                <div class="value" id="kpiProgramadas">0</div>
            </div>
            <div class="kpi">
                <div class="small-muted">Reservas en curso</div>
                <div class="value" id="kpiEnCurso">0</div>
            </div>
            <div class="kpi">
                <div class="small-muted">Reservas finalizadas</div>
                <div class="value" id="kpiFinalizadas">0</div>
            </div>
        </div>

        <!-- KPI operativo extra -->
        <div class="kpis" style="margin-top:12px">
            <div class="kpi" style="background:#fff9e6;border:1px solid #ffe08a">
                <div class="small-muted">Mesas por asignar / reasignar</div>
                <div class="value" id="kpiMesasPorAsignar">0</div>
            </div>
        </div>

        <!-- Operativa: pendientes de pago -->
        <div style="margin-top:18px">
            <h5>Solicitudes de reserva (pendientes de pago)</h5>
            <div class="small-muted">Se cancelan automáticamente si no se paga en 15 min. (countdown en vivo)</div>

            <div
                    id="pendientesAccept"
                    style="margin-top:12px"
                    aria-live="polite"
                    th:insert="~{/fragments/dashboard/fragment_solicitudes :: fragmentSoli}"></div>
        </div>

        <!-- Operativa: mesas por asignar / reasignar -->
        <div style="margin-top:18px">
            <h5>Mesas por asignar / reasignar (por mantenimiento o mesa no definida)</h5>
            <div id="porAsignarList" style="margin-top:12px" aria-live="polite"></div>
        </div>
    </div>
</main>

<!-- Modal Confirmar Solicitud -->
<div class="modal fade" id="confirmarSolicitud" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="confirmarSolicitud" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Seleccionar método de pago</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <select id="metPago">
                    <option value="YAPE">Yape</option>
                    <option value="PLIN">Plin</option>
                    <option value="TRANSFERENCIA">Transferencia</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" id="modalAceptarSoli" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Denegar Solicitud -->
<div class="modal fade" id="denegarSolicitud" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="denegarSolicitud" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Cancelar reserva</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" id="modalDenegarSoli" class="btn btn-danger">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Asignación -->
<div id="assignModal" class="modal-overlay" style="display:none;">
    <div class="modal-card">
        <h5>Asignar mesa</h5>
        <div class="mb-2">
            <label class="form-label" for="assignUbic">Ubicación</label>
            <select id="assignUbic" class="form-control">
                <option value="salon">Salón</option>
                <option value="segundo_piso">Segundo piso</option>
            </select>
        </div>
        <div class="mb-2">
            <label class="form-label" for="assignMesa">Mesa</label>
            <select id="assignMesa" class="form-control"></select>
        </div>
        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
            <button id="assignCancel" class="btn btn-outline-secondary" type="button" onclick="document.getElementById('assignModal').style.display='none'">Cancelar</button>
            <button id="assignSave" class="btn btn-dark" type="button">Guardar</button>
        </div>
    </div>
</div>

<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script defer th:src="@{/js/dashboard.js}"></script>
</body>
</html>
